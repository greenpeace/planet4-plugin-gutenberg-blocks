# Block templates

[Block templates](https://developer.wordpress.org/block-editor/reference-guides/block-api/block-templates/) are a declaration of a list of blocks.

Their content is:
- expanded _like Block patterns_, once it's in the editor it won't change, even if the template declaration changes
- generated by the Editor _like Blocks_, so
  - you only have to manage declaration, _not_ the output
  - you can easily reuse that declaration

## Using a Block template

Block templates appear in the _Blocks_ tab of the _Blocks selector_ in the Editor.  

They can also be copy/pasted in their self closing delimiter form
```html
<!-- wp:planet4-block-templates/my-template /-->
```
and can support attributes
```html
<!-- wp:planet4-block-templates/my-template {"title": "My template title"} /-->
```
This inline version is expanded with its generated content during post editing.

## Creating a Block template

- Create a folder with your BT name
- Add 3 files in it
  - `block.json` is the basic declaration of the block, the same way used [to register block types](https://developer.wordpress.org/block-editor/reference-guides/block-api/block-metadata/)
  - `template.js` should return a `template()` function that contains the minimal definition of the template
  - `index.js` exports all data
- List it in `template-list.js`. That way it will be registered by the editorIndex.js script during Editor loading.

### Example of minimal Block template

_my-template/block.json_
```json
{
  "$schema": "https://schemas.wp.org/trunk/block.json",
  "apiVersion": 2,
  "name": "planet4-block-templates/my-template",
  "title": "My template",
  "description": "My template",
  "category": "planet4",
  "textdomain": "planet4-blocks-backend"
}
```

_my-template/template.js_
```js
// A list of blocks
// A block is [ <string> name, <object> attributes, <?array> inner blocks ] ]
const template = () => ([
  ['core/heading', {level: 1, placeholder: 'Enter title'}],
  ['core/group', {}, [
    ['core/paragraph', {placeholder: 'Enter description'}],
    ['core/buttons', {}, [
      ['core/button']
    ]]
  ]]
]);

export default template;
```

_my-template/index.js_
```js
import metadata from './block.json';
import template from './template';

export { metadata, template };
```

## Adding parameters to you Block template

Adding parameters allows you to easily reuse a template content into other blocks or templates via import.

_my-template/template.js_
```js
// A list of blocks
// A block is [ <string> name, <object> attributes, <?array> inner blocks ] ]
const template = ({
    title: null,
    buttonText: null
}) => ([
  ['core/heading', {level: 1, placeholder: 'Enter title', content: title}],
  ['core/group', {}, [
    ['core/paragraph', {placeholder: 'Enter description'}],
    ['core/buttons', {}, [
      ['core/button', {text: buttonText}]
    ]]
  ]]
]);

export default template;
```

To use those parameters as block attributes, you need to allow those attributes in your block declaration.

_my-template/block.json_
```json
{
  "$schema": "https://schemas.wp.org/trunk/block.json",
  "apiVersion": 2,
  "name": "planet4-block-templates/my-template",
  "title": "My template",
  "description": "My template",
  "category": "planet4",
  "textdomain": "planet4-blocks-backend",
  "attributes": {
    "title": { "type": "string" },
    "buttonText": { "type": "string" }
  }
}
```

## Declaring your Block template into a Block pattern

To have a Block pattern selectable in the _Patterns_ tab of the Blocks selector, you can just use your block template as a self closing block delimiter.  
This declaration will be expanded by the Editor on insertion; once expanded, an update of the template declaration will not update its existing content in posts, and it will stay identified in the _List view_.  
It can use the attributes you declared for your Block template.

_classes/patterns/class-mytemplate.php_
```php
<?php

namespace P4GBKS\Patterns;

class MyTemplate extends Block_Pattern {
    public static function get_name(): string {
        return 'p4/my-template';
    }

    public static function get_config( $params = [] ): array {
        return [
            'title'      => __( 'My template', 'planet4-blocks-backend' ),
            'categories' => [ 'planet4' ],
            'content'    => '<!-- wp:planet4-block-templates/my-template '
                . wp_json_encode( $params, \JSON_FORCE_OBJECT )
                . ' /-->',
        ];
    }
}

```

## Locking a Block template

Export a `templateLock` attribute, following the [templateLock definition](https://developer.wordpress.org/block-editor/reference-guides/block-api/block-templates/#locking)

```js
import metadata from './block.json';
import template from './template';

const templateLock = 'all'; // 'all', 'insert', false

export { metadata, template, templateLock };
```

## Removing a Block template

If we decide to remove a Block template from the available templates, it will trigger an error in the Visual editor "Your site doesn't include support for the `<your block>` block. You can leave this block intact, convert its content to a Custom HTML block, or remove it entirely".  
To avoid this situation, any Block template removal should include a database patch that will remove the html comments describing the block template (ie `<!-- wp:planet4-block-templates/my-template -->` and closing tag) in post content. The content between those tags should stay the same.
